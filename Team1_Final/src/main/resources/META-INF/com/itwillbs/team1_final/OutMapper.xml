<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.team1_final.mapper.OutMapper">

	<!-- 거래처 검색 -->
	<select id="selectAcc" resultType="com.itwillbs.team1_final.vo.AccVO">
		SELECT BUSINESS_NO, CUST_NAME
			FROM acc
			<if test='!keyword.equals("")'>
			WHERE
				<choose>
					<when test='searchType.equals("acc_name")'>
						CUST_NAME LIKE '%${keyword}%'
					</when>
					<when test='searchType.equals("acc_code")'>
						BUSINESS_NO LIKE '%${keyword}%'
					</when>
				</choose>
		</if>
		ORDER BY
			BUSINESS_NO DESC
	</select>
	
	
	<!-- 담당자 검색 -->
	<select id="selectEmp" resultType="com.itwillbs.team1_final.vo.HrVO">
	SELECT *
		FROM emp_view
		WHERE
			EMP_NUM LIKE '%${keyword}%'
	</select>
	
	
	<!-- 품목 검색 -->
	<select id="selectPd" resultType="com.itwillbs.team1_final.vo.PdVO">
		SELECT
			PRODUCT_CD, PRODUCT_NAME, SIZE_DES, REMARKS
			FROM product
			<if test='!keyword.equals("")'>
			WHERE
				<choose>
					<when test='searchType.equals("pd_name")'>
						PRODUCT_NAME LIKE '%${keyword}%'
					</when>
					<when test='searchType.equals("pd_code")'>
						PRODUCT_CD LIKE '%${keyword}%'
					</when>
				</choose>
		</if>
		ORDER BY
			PRODUCT_CD DESC
	</select>
	
	
	<!-- 출고예정코드 추가 또는 증가 -->
	<select id="selectToday" resultType="int">
		SELECT COUNT(OUT_SCHEDULE_CD)
			FROM OUT_SCHEDULE
			WHERE
				OUT_SCHEDULE_CD LIKE '${oUT_TODAY}%'
	</select>
	
	
	<!-- 출고 예정 등록 -->
	<insert id="insertOutSch">
		INSERT
			INTO OUT_SCHEDULE
			VALUES (
				#{OUT_SCHEDULE_CD}
				, #{OUT_TYPE_NAME}
				, #{BUSINESS_NO}
				, #{EMP_NUM}
				, #{OUT_DATE}
				, #{REMARKS}
				, 0
				, #{TOTAL_QTY}
			)
	</insert>
	
	
	<!-- 출고 예정 품목 등록 -->
	<insert id="insertOutSchPd">
		INSERT
			INTO OUT_SCHEDULE_PER_PRODUCT
			VALUES (
				#{PRODUCT_CD}
				, #{OUT_SCHEDULE_CD}
				, #{OUT_SCHEDULE_QTY}
				, 0
				, #{OUT_DATE}
				, #{REMARKS}
				, null
				, 0
			)
	</insert>
	
	
	<!-- 출고 예정 목록 조회 -->
	<select id="selectOutSch" resultType="com.itwillbs.team1_final.vo.OutSchVo">
		SELECT
			DISTINCT(out_schedule_cd), out_type_name, emp_name, out_date, total_qty, out_complete
			FROM outSch_view
			<if test='!keyword.equals("")'>
			WHERE
				<choose>
					<when test='keyword.equals("0")'>
						OUT_COMPLETE = "0"
					</when>
					<when test='keyword.equals("1")'>
						OUT_COMPLETE = "1"
					</when>
				</choose>
			</if>
		ORDER BY out_schedule_cd
	</select>
	
	
	<!-- 출고 예정 목록 - 품목명 -->
	<select id="selectOutPdName" resultType="com.itwillbs.team1_final.vo.OutSchVo">
		SELECT *
			FROM outSch_view
			WHERE OUT_SCHEDULE_CD = #{outSchCd}
		ORDER BY PRODUCT_NAME DESC
		LIMIT 1
	</select>
	
	
	<!-- 출고 예정 목록 - 품목명 외 개수 조회 -->
	<select id="selectExtraPdCount" resultType="int">
		SELECT COUNT(PRODUCT_NAME)
			FROM outSch_view
			WHERE OUT_SCHEDULE_CD = #{outSchCd}
	</select>
	

</mapper>
