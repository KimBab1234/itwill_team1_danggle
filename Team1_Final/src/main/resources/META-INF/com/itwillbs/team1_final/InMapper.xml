<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.team1_final.mapper.InMapper">
	<!-- 사원 조회 -->
	<select id="selectHrList" resultType="com.itwillbs.team1_final.vo.HrVO">
	SELECT *
		FROM emp_view
		WHERE
			EMP_NAME LIKE '%${keyword}%'
	</select>
	
	<!-- 품목 조회 -->
	<select id="selectProductList" resultType="com.itwillbs.team1_final.vo.PdVO">
		SELECT 
			PRODUCT_CD, PRODUCT_NAME, SIZE_DES
			FROM product
			WHERE 
				PRODUCT_NAME LIKE '%${keyword}%'
	</select>
	
	<!-- 거래처 검색 -->
	<select id="selectAcc" resultType="com.itwillbs.team1_final.vo.AccVO">
		SELECT BUSINESS_NO, CUST_NAME
			FROM acc
			WHERE
				CUST_NAME LIKE '%${keyword}%'
	</select>
	
	<!-- 입고예정코드 조회 -->
	<select id="selectToday" resultType="int">
		SELECT COUNT(IN_SCHEDULE_CD)
			FROM in_schedule
			WHERE
				IN_SCHEDULE_CD LIKE '%${today}%'
	</select>
	
	<!-- 입고 예정 등록 -->
	<insert id="insertIncoming">
		INSERT
			INTO in_schedule
			VALUES (
				#{IN_SCHEDULE_CD}
				, #{IN_TYPE_CD}
				, #{BUSINESS_NO}
				, #{EMP_NUM}
				, #{IN_DATE}
				, #{REMARKS}
				, 0
				, #{TOTAL_QTY}
			)
	</insert>
	
	<!-- 입고 예정 상품 등록 -->
	<insert id="insertIncomingProduct">
		INSERT
			INTO in_schedule_per_product
			VALUES (
				#{PRODUCT_CD}
				, #{PRODUCT_NAME}
				, #{SIZE_DES}
				, #{IN_SCHEDULE_QTY}
				, 0
				, null
				, #{IN_PD_SCHEDULE_CD}
				, #{IN_PD_DATE}
				, #{IN_PD_REMARKS}
				, 0
			)
	</insert>
	
	<!-- 입고 예정 목록 -->
	<select id="selectSchedule" resultType="com.itwillbs.team1_final.vo.InListVO">
		SELECT *
			FROM in_schedule_view
	</select>
	
	<!-- 입고 예정 목록(완료/진행중/전체) -->
	<select id="selectScheduleStatus" resultType="com.itwillbs.team1_final.vo.InListVO">
		SELECT *
			FROM in_schedule_view
			WHERE
				IN_COMPLETE LIKE '%${keyword}%'
	</select>
	
	<!-- 입고처리 진행상태 -->
	<select id="selectProductProgress" resultType="com.itwillbs.team1_final.vo.InPdVO">
		SELECT *
			FROM in_schedule_per_product
			WHERE 
				IN_PD_SCHEDULE_CD LIKE '${keyword}'
	</select>
	
	<!-- 입고 예정 수정 조회 -->
	<select id="selectInProduct" resultType="com.itwillbs.team1_final.vo.InVO">
		 SELECT ins.IN_SCHEDULE_CD, ins.IN_TYPE_CD, ins.BUSINESS_NO, ins.EMP_NUM, ins.IN_DATE, ins.REMARKS, ins.TOTAL_QTY, h.EMP_NAME, ac.CUST_NAME
		 	FROM  in_schedule AS ins
		 	JOIN hr AS h
		 		ON ins.EMP_NUM = h.EMP_NUM
		 	JOIN acc AS ac
		 		ON ins.BUSINESS_NO = ac.BUSINESS_NO
		 		WHERE 
		 			ins.IN_SCHEDULE_CD LIKE '${keyword}'
	</select>
	
	<!-- 이름 만들 때 쓸 상품 개수 구해오기 -->
	<select id="selectCountName" resultType="int">
		SELECT COUNT(*)
			FROM in_schedule_per_product
			WHERE 
				IN_PD_SCHEDULE_CD = '${in_SCHEDULE_CD}'
	</select>
	
	<!-- 입고 예정 목록 종결 상태 전환 -->
	<update id="updateCom">
		UPDATE in_schedule
			<choose>
				<when test="com_status.equals('종결')">
					SET IN_COMPLETE = "1"
				</when>
				<when test="com_status.equals('취소')">
					SET IN_COMPLETE = "0"
				</when>
			</choose>
			WHERE
				IN_SCHEDULE_CD = '${keyword}'
	</update>
	
	<!-- 입고 처리 목록 -->
	<select id="selectProgressList" resultType="com.itwillbs.team1_final.vo.InListVO">
		SELECT *
			FROM in_process_view
	</select>
</mapper>
